{% extends "tracker/layout.html" %}
{% load humanize %}
{% block content %}
<form action="#" method="post" class="d-flex" role="search">
  {% csrf_token %}
  <input list="pv_ids" name="pv_id" id="pv_id" class="form-control me-2" type="search" placeholder="PV ID" aria-label="Search">
  <datalist id="pv_ids">
    {% for pv in pvs %}
    <option value="{{ pv.pv_id }}">
    {% endfor %}
</datalist>
  <input class="form-control me-2" type="date" name="date">
  <button class="btn btn-success" type="submit">Generate PV/PVs</button>
</form>
<small><a class="btn btn-primary" href="{% url 'add_expense' %}">Add Expense</a></small>
<table class="table table-striped table-bordered table-dark table-striped-columns table-responsive-sm">
    <thead class="thead-dark">
    <tr>
      <th scope="col">Payment_Voucher_id</th>
      <th scope="col">Prepared_By</th>
      <th scope="col">Item</th>
      <th scope="col">Quantity</th>
      <th scope="col">Amount</th>
      <th scope="col">Total Amount</th>
      <th scope="col">status</th>
      <th scope="col">Date</th>
    </tr>
  </thead>
  <tbody>
    {% for expense in expenses %}
    <tr>
        <td><a type="payroll" href="#">{{expense.pv_id}}</a></td>
        <td>{{expense.prepared_by.first_name}} {{expense.prepared_by.last_name}}</td>
        <td>{{expense.item}}</td>
        <td style="text-align: center;">{{expense.quantity}}</td>
        <td>{{expense.amount|floatformat:2|intcomma}}</td>
        <td>{{expense.total_amount|floatformat:2|intcomma}}</td>
        <td>{{expense.status}}</td>
        <td>{{expense.date|date:"F d, Y" }}</td>
        <td><a href="{% url 'update_expense' expense.id %}">Edit</a></td>
    </tr>
    {% endfor %}
    <tr>
        <td colspan="3" scope="col" style="font-weight: bold; color: red;">TOTALS</td>
        <td style="text-align: center;" scope="col" style="font-weight: bold;">{{ quantity_total }}</td>
        <td scope="col" style="font-weight: bold;">{{ amount_total|floatformat:2|intcomma }}</td>
        <td scope="col" style="font-weight: bold;">{{ total_amount_total|floatformat:2|intcomma }}</td>
    </tr>
</tbody>
</table>
{% if expenses.has_previous %}
<a class="btn btn-outline-info mb-4" href="{% url 'expenses' %}?page=1">First</a>
<a class="btn btn-outline-info mb-4" href="{% url 'expenses' %}?page={{ expenses.previous_page_number }}">Previous</a>
{% endif %}

{% for num in expenses.paginator.page_range %}
{% if expenses.number == num %}
  <a class="btn btn-info mb-4" href="{% url 'expenses' %}?page={{ num }}">{{ num }}</a>
{% elif num > expenses.number|add:'-3' and num < expenses.number|add:'3' %}
  <a class="btn btn-outline-info mb-4" href="{% url 'expenses' %}?page={{ num }}">{{ num }}</a>
{% endif %}
{% endfor %}

{% if expenses.has_next %}
<a class="btn btn-outline-info mb-4" href="{% url 'expenses' %}?page={{ expenses.next_page_number }}">Next</a>
<a class="btn btn-outline-info mb-4" href="{% url 'expenses' %}?page={{ expenses.paginator.num_pages }}">Last</a>
{% endif %}
{% endblock content %}